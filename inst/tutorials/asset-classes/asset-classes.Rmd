---
title: "Asset Classes"
output:
  learnr::tutorial:
    progressive: true
    allow_skip: false
runtime: shiny_prerendered
---

```{r setup, include=FALSE, message=FALSE, warnings = F}
library(learnr)
library(dplyr)
library(lubridate)
library(gt)
library(ggplot2)
library(moments)
library(glue)


knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  cache = FALSE,
  fig.width = 9,
  fig.height = 6,
  fig.align = "center",
  tidy = FALSE,
  strip.white = TRUE,
  out.width = '100%'
)

bd_txt <-
  function(x,
           title = "Grading",
           subtitle = "-",
           width = 700) {
    if (nchar(gsub(" ", "", subtitle)) == 0) {
      subtitle <- "-"
    }
    y <- x %>% gt::gt() %>%
      gt::tab_header(title = title, subtitle = subtitle) %>%
      gt::tab_style(style = cell_text(weight = "bold"),
                    locations = cells_column_labels(colnames(.))) %>%
      gt::tab_style(style = list(
        cell_fill(color = "royalblue"),
        cell_text(color = "white", weight = "bold")
      ),
      locations = cells_title(groups = c("title")))
    y = y %>% tab_options(table.width = px(width),
                          table.font.size = pct(80))
    return(y)
  }

bd_lo <- function(x, width = 700) {
  y <- x %>% gt::gt(rowname_col = rownames(.)) %>%
    gt::tab_header(title = "Learning Objectives",
                   subtitle = "Desired Outcomes Sought for Mastery of Material") %>%
    gt::tab_style(style = cell_text(weight = "bold"),
                  locations = cells_column_labels(colnames(.))) %>%
    gt::tab_style(style = list(
      cell_fill(color = "royalblue"),
      cell_text(color = "white", weight = "bold")
    ),
    locations = cells_title(groups = c("title")))
  y = y %>% tab_options(table.width = px(width),
                        table.font.size = pct(80))
  return(y)
}


from = as.Date("2014-01-01")
to = lubridate::rollback(Sys.Date())
tickers <-  c("TLT","USO","GLD","VNQ","SPY")
asset1 <- tickers[2] 
asset2 <- tickers[3] 
cors <- c(25,75,252)
```

## Problem We Are Solving

**This quiz consists in analyzing returns across multiple asset classes.**

### Asset classes considered:

+ US Long Term bonds with the [iShares 20+ Year Treasury Bond ETF](https://etfdb.com/etf/TLT/#etf-ticker-profile).
+ Energy Liquids with the [United States Oil Fund](https://etfdb.com/etf/USO/#etf-ticker-profile).
+ Gold with the [SPDR Gold Trust](https://etfdb.com/etf/GLD/#etf-ticker-profile).
+ Real Estate with the [Vanguard Real Estate Index Fund](https://etfdb.com/etf/VNQ/#etf-ticker-profile).
+ US equities with the [SPDR S&P 500 ETF](https://etfdb.com/etf/SPY/#etf-ticker-profile).

```{r}
tickers
```

### Your Ask

In a concise .Rmd using `tidy` workflow (i.e. no `xts`), do the following:

1. I am your business leader and, despite knowing markets at a high level, my Finance background is quite limited. Add a summary at the beginning of your document telling me in a few bullet points what key messages I should draw from your analysis so I can cut and paste them in a PowerPoint for my boss.   
2. Extract data from `r from` to `r to` and compute daily `log()` returns adjusted for splits and dividends. Do not display in your document as this is the data wrangling of it and it serves no purpose in a business document.
3. Plot histograms of returns by asset class in a manner that you can effectively visualize the comparison.
4. Show a table of distribution moments of all assets. Complement with a short commentary on how they compare with a normal distribution.
5. Show a plot of the correlation matrix between all assets.
6. Show a chart of rolling correlations between `r asset1` and `r asset2` with windows of `r cors[1]`, `r cors[2]` and `r cors[3]` business days.
7. Compute the Jarque-Bera statistics on all assets

  + Display the results in a single table.
  + State which one(s) are normally distributed and why. 
8. Compute the Kolmogorov-Smirnov (“KS”) on `SPY` returns and state whether the results indicate that the returns are normally distributed.

## Grading

If you take this exercise as part of a graded item in a course, see the Grading section in class notes. Grading is consistent with learning objectives.

```{r, echo=F,include=TRUE, fig.height=3}
tibble(
  Competency = c("Summary",
                 "Presentation",
                 "Accuracy of code and results"),
  Measure = c(
    "Ability to distill and communicate the key findings.",
    "Professionally rendered presentations. Clean document of unnecessary clutter not relevant to the story. Assume I am a business leader and interested in the story, not how you got to it. Format properly your charts and tables.",
    "No errors in computations."
  )
) %>% bd_lo()
```

